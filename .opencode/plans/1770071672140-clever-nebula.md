# Migration Plan: Apply Publishing Config from core-old to core

## Summary

Migrate the npm publishing configuration from `@packages/core-old/` (template) to `@packages/core/` (actual package) to enable proper npm publishing with dual CJS + ESM format support.

---

## Root Cause: React Types Version Mismatch

The build fails with TS2742 errors because the monorepo has conflicting `@types/react` versions:
- `packages/core` uses `@types/react@^19`
- `packages/components`, `packages/core-old`, `apps/docs` use `@types/react@^18`

When generating `.d.ts` files, the dts plugin picks up `@types/react@18.3.27` instead of `@types/react@19.2.10`, causing type incompatibility errors.

---

## Changes Required

### 1. Upgrade All Packages to React 19

**File:** `packages/components/package.json`

```json
{
  "dependencies": {
    "react": "^19.0.0"
  },
  "devDependencies": {
    "@types/react": "^19",
    "@types/react-dom": "^19"
  }
}
```

**File:** `apps/docs/package.json`

```json
{
  "dependencies": {
    "react": "^19.0.0",
    "react-dom": "^19.0.0"
  },
  "devDependencies": {
    "@types/react": "^19",
    "@types/react-dom": "^19"
  }
}
```

**File:** `packages/core-old/package.json`

```json
{
  "dependencies": {
    "react": "^19.0.0"
  },
  "devDependencies": {
    "@types/react": "^19",
    "@types/react-dom": "^19"
  }
}
```

Then run `pnpm install` to update the lockfile.

---

### 2. Update `packages/core/package.json`

#### Add/Update these fields:

```json
{
  "main": "./dist/index.cjs",
  "module": "./dist/index.mjs", 
  "types": "./dist/index.d.mts",
  "sideEffects": false,
  "exports": {
    ".": {
      "import": {
        "types": "./dist/index.d.mts",
        "default": "./dist/index.mjs"
      },
      "require": {
        "types": "./dist/index.d.cts",
        "default": "./dist/index.cjs"
      }
    },
    "./package.json": "./package.json"
  },
  "publishConfig": {
    "access": "public"
  }
}
```

#### Add these scripts:

```json
{
  "scripts": {
    "lint:package": "publint",
    "clean": "rm -rf .turbo && rm -rf node_modules && rm -rf dist"
  }
}
```

---

### 3. Update `packages/core/tsdown.config.ts`

Change the `format` option to output both CJS and ESM:

```typescript
format: ["cjs", "esm"],
```

---

## Summary of Changes

| File | Change |
|------|--------|
| `packages/components/package.json` | Upgrade react to `^19.0.0`, @types/react to `^19` |
| `apps/docs/package.json` | Upgrade react/react-dom to `^19.0.0`, @types/react to `^19` |
| `packages/core-old/package.json` | Upgrade react to `^19.0.0`, @types/react to `^19` |
| `packages/core/package.json` | Add `sideEffects: false` |
| `packages/core/package.json` | Update `main` to `./dist/index.cjs` |
| `packages/core/package.json` | Update `exports` with dual import/require |
| `packages/core/package.json` | Add `publishConfig.access: "public"` |
| `packages/core/package.json` | Add `lint:package` and `clean` scripts |
| `packages/core/tsdown.config.ts` | Change `format` to `["cjs", "esm"]` |

---

## Verification Steps

1. **Install dependencies after adding overrides:**
   ```bash
   pnpm install
   ```

2. **Build the package:**
   ```bash
   pnpm build --filter=@ai-tui/core
   ```

3. **Verify output files exist:**
   - `dist/index.mjs` (ESM)
   - `dist/index.cjs` (CJS)  
   - `dist/index.d.mts` (ESM types)
   - `dist/index.d.cts` (CJS types)

4. **Validate package configuration:**
   ```bash
   cd packages/core && pnpm lint:package
   ```

5. **Preview publishable files:**
   ```bash
   cd packages/core && npm pack --dry-run
   ```

---

## Files to Modify

1. `/packages/components/package.json` - Upgrade to React 19
2. `/apps/docs/package.json` - Upgrade to React 19
3. `/packages/core-old/package.json` - Upgrade to React 19
4. `/packages/core/package.json` - Publishing config
5. `/packages/core/tsdown.config.ts` - Dual format output
